# 使用指南（Usage Guide）

## 1. 前置需求
- Node.js（建議 20+，若使用 18 需確認 `import.meta.dirname` 相容性）
- pnpm
- MySQL

## 2. 安裝
```bash
pnpm install
```

## 3. 環境變數
請在專案根目錄建立 `.env`，至少包含下列欄位：

### 必填（後端）
- `DATABASE_URL`：MySQL 連線字串
- `JWT_SECRET`：JWT 簽章金鑰
- `OAUTH_SERVER_URL`：OAuth 伺服器網址
- `VITE_APP_ID`：OAuth App ID（前後端共用）
- `CS_ADMIN_USERNAME` / `CS_ADMIN_PASSWORD`：客服後台帳密

### 可選（依功能使用）
- `OWNER_OPEN_ID`：站長/管理員 OpenId
- `BUILT_IN_FORGE_API_URL` / `BUILT_IN_FORGE_API_KEY`：Forge 服務（通知、LLM、影像、語音、地圖等）
- `VITE_OAUTH_PORTAL_URL`：OAuth Portal URL（前端登入）
- `VITE_FRONTEND_FORGE_API_URL` / `VITE_FRONTEND_FORGE_API_KEY`：前端地圖 Proxy

## 4. 初始化資料庫
```bash
pnpm db:push
```

## 5. 開發模式
```bash
pnpm dev
```
- 預設使用 3000 port，若被佔用會自動往後找可用 port。

## 6. 建置與上線
```bash
pnpm build
pnpm start
```
- `pnpm build` 會輸出 `dist/public`（前端）與 `dist/index.js`（後端）。

## 7. 客服後台操作
1. 前往 `/admin/login`。
2. 使用 `CS_ADMIN_USERNAME` / `CS_ADMIN_PASSWORD` 登入。
3. 進入 `/admin/customer-service` 管理對話。

## 8. 訪客客服操作
1. 在網站右下角點擊客服 Widget。
2. 輸入訊息後送出，客服端將於後台可見。

## 9. 常用指令
```bash
pnpm dev        # 開發模式
pnpm build      # 產出正式版本
pnpm start      # 啟動正式版本
pnpm test       # 執行 Vitest
pnpm check      # TypeScript 型別檢查
pnpm db:push    # Drizzle migration
```